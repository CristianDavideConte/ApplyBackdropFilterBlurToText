<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<style>
			:root{
					--svgPath:./svgs/standard.svg;
					--svgUrl: url(./svgs/standard.svg);

					--backgroundUrl:url(./images/backgroundOriginal.jpg);
			}

			html,body {
				margin: 0;
    		scroll-behavior: smooth;
			}

			#buttonSection {
				z-index: 2;
				position:fixed;
				display: flex;
				justify-content: center;
				align-items: center;
				width: 100vw;
				top: 50%;
			}

			button {
				cursor: pointer;
				margin: 0 5vw;
				padding: 3vmin;
				outline:none;
				border:none;
				border-radius: 1rem;
				background-color: rgba(200,30,30, 1);
				transition: all 0.3s;
			}

			#disableShadows {
				z-index: 2;
				position: fixed;
				margin-left:50%;
				background-color: rgba(0,200,30, 1);
				-webkit-transform: translate3d(-50%,0,0);
				transform: translate3d(-50%,0,0);
			}

			#disableShadows:active {
					-webkit-transform: translate3d(-50%,0,0) scale3d(0.9,0.9,0.9);
					transform: translate3d(-50%,0,0) scale3d(0.9,0.9,0.9);
			}

			button:active {
					-webkit-transform: scale3d(0.9,0.9,0.9);
					transform: scale3d(0.9,0.9,0.9);
			}

			.backgroundLayer {
					z-index: -1;
					width: 100vw;
					height: 100vh;
					display: flex;
					position: fixed;
			}

			#svgWrapper {
				position: absolute;
				width:100%;
				height: 100%;
				top:50%;
			}

			#svg {
				width: 100%;
				height: 100%;
			}

			#svg.reset {
				-webkit-mask-image: none;
				mask-image: none;
			}

			#svgShadow {
				width:100%;
				height:100%;
				-webkit-transform: translate3d(0,-100%, 0);
				transform: translate3d(0,-100%, 0);
			}

			#svgShadow.enabled {
				opacity: 1;
			}

			#svgShadow.disabled {
				opacity: 0;
			}

			.method1 .backgroundLayer {
			  background: var(--backgroundUrl) 0 0;
				background-repeat: no-repeat;
				background-position: center;
			}

			#svg.method1 {
				filter: blur(20px) saturate(180%);
				-webkit-filter: blur(20px) saturate(180%);
		    -moz-filter: blur(20px) saturate(180%);
		    -ms-filter: blur(20px) saturate(180%);
		    -o-filter: blur(20px) saturate(180%);

				background: var(--backgroundUrl);
				background-repeat: no-repeat;
				background-attachment: fixed;
				background-position: center;

				/* Chrome, Safari and all webkit browsers */
  			-webkit-mask-image: var(--svgUrl);
				-webkit-mask-size: contain;
				-webkit-mask-position: center;
				-webkit-mask-repeat: no-repeat;

				/* FIREFOX */
				mask-image: var(--svgUrl);
				mask-size: contain;
				mask-position: center;
				mask-repeat: no-repeat;
			}

			.method2 .backgroundLayer{
				background: var(--backgroundUrl) 0 0;
				background-repeat: no-repeat;
				background-position: center;
			}

			#svg.method2 {
				-webkit-transform: translate3d(0, 0, 0);
				transform: translate3d(0, 0, 0);
				background-color: rgba(255,255,255,0.1);
				-webkit-backdrop-filter: blur(13px) saturate(250%);
				backdrop-filter: blur(13px) saturate(250%);

				/* Chrome, Safari and all webkit browsers */
				-webkit-mask-image: var(--svgUrl);
				-webkit-mask-size: contain;
				-webkit-mask-position: center;
				-webkit-mask-repeat: no-repeat;

				/* FIREFOX */
				mask-image: var(--svgUrl);
				mask-size: contain;
				mask-position: center;
				mask-repeat: no-repeat;
			}

			.method3 .backgroundLayer {
				background: var(--backgroundUrl) 0 0;
				background-repeat: no-repeat;
				background-position: center;
			}

			#svg.method3 {
				background: url(./images/backgroundBlurred.jpg);
				background-repeat: no-repeat;
				background-attachment: fixed;
				background-position: center;

				/* Chrome, Safari and all webkit browsers */
  			-webkit-mask-image: var(--svgUrl);
				-webkit-mask-size: contain;
				-webkit-mask-position: center;
				-webkit-mask-repeat: no-repeat;

				/* FIREFOX */
				mask-image: var(--svgUrl);
				mask-size: contain;
				mask-position: center;
				mask-repeat: no-repeat;
			}
		</style>
	</head>

	<body>
		<section class = "backgroundLayer"></section>
		<div id = "buttonSection">
			<button id = "method1">Method 1: filter:blur()</button>
			<button id = "method2">Method 2: backdrop-filter:blur()</button>
			<button id = "method3">Method 3: mask over already-blurred background</button>
		</div>
		<button id = "disableShadows">Shadows Enabled</button>
		<section id = "svgWrapper">
			<div id = "svg"/></div>
			<svg id = "svgShadow" class = "enabled">
				<defs>
				  <filter id = "trans-shadow">
				  <feGaussianBlur stdDeviation = "5"/>
				  <feComposite operator = "out" in2 = "SourceGraphic"/>
				  </filter>
				</defs>
	  		<image id = "svgShadowImage" filter = "url(#trans-shadow)" x = "0" y = "0" width = "100%" height = "100%" />
			</svg>
		</section>
	</body>
	<script>
		function _changeMethod(className) {
			let _svgElement = document.getElementById("svg");
			window.requestAnimationFrame(() => {
				_svgElement.className = className;
				document.body.className = className;
				/*
				 * The next 2 istructions allows the mask to properly adjust to the changes
				 */
				_svgElement.classList.add("reset");
				window.requestAnimationFrame(() => _svgElement.classList.remove("reset"));

				let buttons = document.getElementsByTagName("button");
				for(const button of buttons)
					if(button.id != "disableShadows")
						button.style.background = (button.id == className) ? "rgba(0,200,30, 1)" : "rgba(200,30,30, 1)";
			});
		}

		document.getElementById("method1").addEventListener("click", () => _changeMethod("method1"),{passive:true});
		document.getElementById("method2").addEventListener("click", () => _changeMethod("method2"),{passive:true});
		document.getElementById("method3").addEventListener("click", () => _changeMethod("method3"),{passive:true});
		document.getElementById("disableShadows").addEventListener("click", () => {
			let name = 	document.getElementById("svgShadow").className.baseVal;
			document.getElementById("svgShadow").className.baseVal = (name == "enabled") ? "disabled" : "enabled";
			document.getElementById("disableShadows").innerHTML = (name == "enabled") ? "Shadows Disabled" : "Shadows Enabled";
			document.getElementById("disableShadows").style.backgroundColor = (name == "enabled") ? "rgba(200,30,30, 1)" : "rgba(0,200,30, 1)";
		},{passive:true});

		let path = getComputedStyle(document.body).getPropertyValue("--svgPath").trim();
		document.getElementById("svgShadowImage").setAttribute("href", path);
	</script>

	<script>
		/*
		 * Performs a scrolling test
		 */
		let _testTimes = 0;
		function testSmoothness() {
			if(_testTimes < 50) {
				let _scrollAmmount = (_testTimes % 2 == 0) ? window.scrollY + window.innerHeight : window.scrollY - window.innerHeight;
				window.scroll(0, _scrollAmmount);
				_testTimes++;
				setTimeout(testSmoothness, 800);
			}
		}
	</script>
</html>
